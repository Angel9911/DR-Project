{"ast":null,"code":"import { PipeTransform, Renderer2 } from '@angular/core';\nimport { of } from 'rxjs';\nimport { FormControl } from '@angular/forms';\nimport { map, startWith } from 'rxjs/operators';\nimport { DecimalPipe, DOCUMENT } from '@angular/common';\nimport { HttpClientService } from '../../../service/customer/http-client.service';\nimport { DataService } from '../../../service/data.service';\nimport { User_account } from '../../../models/user_account';\n//import {Sort} from '@angular/material';\nimport { PaymentServiceService } from '../../../service/payment-service.service';\nimport { PaymentOrder } from '../../../models/PaymentOrder';\nimport { ChatbotServiceService } from '../../../service/chatbot-service.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../service/chatbot-service.service\";\nimport * as i2 from \"../../../service/payment-service.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../../../service/customer/http-client.service\";\nimport * as i5 from \"../../../service/data.service\";\nfunction LayoutComponent_tr_31_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const package_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\\u0414\\u043E \\u043E\\u0444\\u0438\\u0441(\", package_r1.office.office_location, \")\");\n  }\n}\nfunction LayoutComponent_tr_31_ng_template_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0);\n  }\n  if (rf & 2) {\n    const package_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵtextInterpolate1(\"\\u0414\\u043E \\u0430\\u0434\\u0440\\u0435\\u0441(\", package_r1.customer.address, \")\");\n  }\n}\nfunction LayoutComponent_tr_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 18);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵelement(4, \"ngb-highlight\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵelement(6, \"ngb-highlight\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtemplate(8, LayoutComponent_tr_31_div_8_Template, 2, 1, \"div\", 20);\n    i0.ɵɵtemplate(9, LayoutComponent_tr_31_ng_template_9_Template, 1, 1, \"ng-template\", null, 21, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵelement(12, \"ngb-highlight\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵelement(14, \"ngb-highlight\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵelement(16, \"ngb-highlight\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\");\n    i0.ɵɵelement(18, \"ngb-highlight\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"td\");\n    i0.ɵɵelement(20, \"ngb-highlight\", 19);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const package_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const _r4 = i0.ɵɵreference(10);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r2 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"result\", package_r1.name_package)(\"term\", ctx_r0.filter.value);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"result\", package_r1.typePackage.type_name)(\"term\", ctx_r0.filter.value);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", package_r1.office)(\"ngIfElse\", _r4);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"result\", package_r1.package_price)(\"term\", ctx_r0.filter.value);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"result\", package_r1.total_cost)(\"term\", ctx_r0.filter.value);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"result\", package_r1.date_register_package)(\"term\", ctx_r0.filter.value);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"result\", package_r1.date_delivery_package)(\"term\", ctx_r0.filter.value);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"result\", package_r1.statusPackage.status_type)(\"term\", ctx_r0.filter.value);\n  }\n}\n// tslint:disable-next-line:prefer-const\nlet customerPackages;\n// tslint:disable-next-line:prefer-const\nfunction search(text, pipe) {\n  return customerPackages.filter(custPackage => {\n    console.log(custPackage);\n    const term = text.toLowerCase();\n    return custPackage.name_package.toLowerCase().includes(term) || custPackage.statusPackage.status_type.toLowerCase().includes(term) || custPackage.typePackage.type_name.toLowerCase().includes(term);\n  });\n}\nexport let LayoutComponent = /*#__PURE__*/(() => {\n  class LayoutComponent {\n    // tslint:disable-next-line:max-line-length\n    constructor(chatbotService, paymentService, renderer2, document, pipe, httpClientService, dataService) {\n      this.chatbotService = chatbotService;\n      this.paymentService = paymentService;\n      this.renderer2 = renderer2;\n      this.document = document;\n      this.httpClientService = httpClientService;\n      this.dataService = dataService;\n      this.payppalIcon = '../../assets/images/paypal_logo.png';\n      this.product = new PaymentOrder();\n      this.userAcc = new User_account();\n      this.filter = new FormControl('');\n      this.username = sessionStorage.getItem('username');\n      console.log(this.username);\n      this.httpClientService.getPackages(this.username).subscribe(data => {\n        // @ts-ignore\n        customerPackages = [...data];\n        this.sortedData = of(customerPackages);\n        // tslint:disable-next-line:only-arrow-functions\n        this.packages$ = this.filter.valueChanges.pipe(startWith(''), map(text => search(text, pipe)));\n      });\n      this.product.customer_username = this.username;\n      this.product.package_name = 'Пералня';\n      // tslint:disable-next-line:no-unused-expression\n      this.product.package_type = 'Колет';\n      this.product.total_price = 133.00;\n      this.product.package_price = 123.00;\n      this.product.shipping = 5.00;\n      this.product.tax_price = 5.00;\n      /* this.paymentService.makePayment(this.product).toPromise().then(res => {\r\n        this.result = res;\r\n        paypalIframe.src = res;\r\n        paypalIframe.style.display = 'block';\r\n      }); */\n    }\n    // tslint:disable-next-line:use-life-cycle-interface\n    ngAfterViewInit() {\n      /*payButton.addEventListener('click', function() {\r\n        // tslint:disable-next-line:no-shadowed-variable\r\n        this.paymentService.makePayment().toPromise().then(res => {\r\n          this.result = res;\r\n          console.log(this.result);\r\n          if (typeof this.result === 'string') {\r\n            paypalEndpoint = this.result;\r\n                }\r\n        });\r\n      }); */\n    }\n    ngOnInit() {}\n    makePayment() {\n      const paypalIframe = document.getElementById('paypal-iframe');\n      this.paymentService.makePayment(this.product).toPromise().then(res => {\n        this.result = res;\n        console.log(this.result);\n        if (typeof this.result === 'string') {\n          console.log(this.result);\n          window.open(this.result, '_blank', 'width=600, height=400');\n        }\n      });\n      /* const paypalIframe = document.getElementById('paypal-iframe') as HTMLIFrameElement;\r\n              this.paymentService.makePayment(this.product).toPromise().then(res => {\r\n         paypalIframe.src = res;\r\n         paypalIframe.style.display = 'block';\r\n         }); */\n    }\n\n    generateInvoice() {\n      this.httpClientService.generateInvoice();\n    }\n    sortData(sort) {\n      const data = customerPackages.slice();\n      if (!sort.active || sort.direction === '') {\n        this.sortedData = of(data);\n        return;\n      }\n      this.sortedData = of(data.sort((a, b) => {\n        const isAsc = sort.direction === 'asc';\n        switch (sort.active) {\n          case 'name':\n            return this.compare(a.name_package, b.name_package, isAsc);\n          case 'price':\n            return this.compare(a.package_price, b.package_price, isAsc);\n          case 'total_price':\n            return this.compare(a.total_cost, b.total_cost, isAsc);\n          default:\n            return 0;\n        }\n      }));\n      console.log(this.sortedData);\n    }\n    // @ts-ignore\n    compare(a, b, isAsc) {\n      return (a < b ? -1 : 1) * (isAsc ? 1 : -1);\n    }\n    getTotalPackagePrice() {\n      return customerPackages.map(t => t.package_price).reduce((a, b) => a + b, 0);\n    }\n    getTotalCost() {\n      return customerPackages.map(t => t.total_cost).reduce((a, b) => a + b, 0);\n    }\n  }\n  LayoutComponent.ɵfac = function LayoutComponent_Factory(t) {\n    return new (t || LayoutComponent)(i0.ɵɵdirectiveInject(i1.ChatbotServiceService), i0.ɵɵdirectiveInject(i2.PaymentServiceService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(DOCUMENT), i0.ɵɵdirectiveInject(i3.DecimalPipe), i0.ɵɵdirectiveInject(i4.HttpClientService), i0.ɵɵdirectiveInject(i5.DataService));\n  };\n  LayoutComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LayoutComponent,\n    selectors: [[\"ng-component\"]],\n    decls: 48,\n    vars: 7,\n    consts: [[1, \"example-container\"], [1, \"search\"], [1, \"mb-3\", \"row\"], [\"for\", \"table-filtering-search\", 1, \"col-xs-3\", \"col-sm-auto\", \"col-form-label\"], [1, \"col-xs-3\", \"col-sm-auto\"], [\"id\", \"table-filtering-search\", \"type\", \"text\", 1, \"form-control\", 3, \"formControl\"], [\"matSort\", \"\", 1, \"table\", \"table-striped\", 3, \"matSortChange\"], [\"scope\", \"col\"], [\"mat-sort-header\", \"name\"], [\"mat-sort-header\", \"price\"], [\"mat-sort-header\", \"total_price\"], [4, \"ngFor\", \"ngForOf\"], [\"colspan\", \"4\", 2, \"text-align\", \"right\"], [\"id\", \"invoice-button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"paypal-container\"], [1, \"paypal-logo\", 3, \"src\"], [\"id\", \"pay-button\", 1, \"btn\", \"btn-primary\", \"paypal-button\", 3, \"click\"], [\"id\", \"paypal-iframe\", \"src\", \"\", \"width\", \"300\", \"height\", \"300\", 2, \"display\", \"none\"], [\"scope\", \"row\"], [3, \"result\", \"term\"], [4, \"ngIf\", \"ngIfElse\"], [\"elseBlock\", \"\"]],\n    template: function LayoutComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-header-layout-user\");\n        i0.ɵɵelementStart(1, \"mat-sidenav-container\", 0)(2, \"mat-sidenav-content\")(3, \"form\", 1)(4, \"div\", 2)(5, \"label\", 3);\n        i0.ɵɵtext(6, \"\\u0422\\u044A\\u0440\\u0441\\u0438 \\u043F\\u043E \\u0438\\u043C\\u0435 \\u043D\\u0430 \\u043F\\u0440\\u0430\\u0442\\u043A\\u0430:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 4);\n        i0.ɵɵelement(8, \"input\", 5);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(9, \"table\", 6);\n        i0.ɵɵlistener(\"matSortChange\", function LayoutComponent_Template_table_matSortChange_9_listener($event) {\n          return ctx.sortData($event);\n        });\n        i0.ɵɵelementStart(10, \"thead\")(11, \"tr\")(12, \"th\", 7);\n        i0.ɵɵtext(13, \"#\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"th\", 8);\n        i0.ɵɵtext(15, \"\\u0418\\u043C\\u0435 \\u043D\\u0430 \\u043F\\u0440\\u0430\\u0442\\u043A\\u0430\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"th\", 7);\n        i0.ɵɵtext(17, \"\\u0422\\u0438\\u043F \\u043D\\u0430 \\u043F\\u0440\\u0430\\u0442\\u043A\\u0430\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"th\", 7);\n        i0.ɵɵtext(19, \"\\u0410\\u0434\\u0440\\u0435\\u0441 \\u043D\\u0430 \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0430\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"th\", 9);\n        i0.ɵɵtext(21, \"\\u0426\\u0435\\u043D\\u0430 \\u043D\\u0430 \\u043F\\u0440\\u0430\\u0442\\u043A\\u0430\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"th\", 10);\n        i0.ɵɵtext(23, \"\\u0426\\u0435\\u043D\\u0430 \\u043D\\u0430 \\u043F\\u0440\\u0430\\u0442\\u043A\\u0430(\\u0441 \\u0432\\u043A\\u043B\\u044E\\u0447\\u0435\\u043D\\u0430 \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0430)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"th\", 7);\n        i0.ɵɵtext(25, \"\\u0414\\u0430\\u0442\\u0430 \\u043D\\u0430 \\u0438\\u0437\\u043F\\u0440\\u0430\\u0449\\u0430\\u043D\\u0435\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"th\", 7);\n        i0.ɵɵtext(27, \"\\u0414\\u0430\\u0442\\u0430 \\u043D\\u0430 \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0430\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"th\", 7);\n        i0.ɵɵtext(29, \"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441 \\u043D\\u0430 \\u043F\\u0440\\u0430\\u0442\\u043A\\u0430\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(30, \"tbody\");\n        i0.ɵɵtemplate(31, LayoutComponent_tr_31_Template, 21, 17, \"tr\", 11);\n        i0.ɵɵpipe(32, \"async\");\n        i0.ɵɵelementStart(33, \"tr\")(34, \"th\", 12);\n        i0.ɵɵtext(35, \"\\u041E\\u0431\\u0449\\u0430 \\u0441\\u0443\\u043C\\u0430(\\u0431\\u0435\\u0437 \\u0442\\u0430\\u043A\\u0441\\u0430 \\u0442\\u0440\\u0430\\u043D\\u0441\\u043F\\u043E\\u0440\\u0442)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"th\");\n        i0.ɵɵtext(37);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(38, \"th\");\n        i0.ɵɵtext(39);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(40, \"button\", 13);\n        i0.ɵɵlistener(\"click\", function LayoutComponent_Template_button_click_40_listener() {\n          return ctx.generateInvoice();\n        });\n        i0.ɵɵtext(41, \"Generate invoice\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(42, \"div\", 14);\n        i0.ɵɵelement(43, \"img\", 15);\n        i0.ɵɵelementStart(44, \"button\", 16);\n        i0.ɵɵlistener(\"click\", function LayoutComponent_Template_button_click_44_listener() {\n          return ctx.makePayment();\n        });\n        i0.ɵɵtext(45, \"Pay with PayPal\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(46, \"iframe\", 17)(47, \"app-chatbot\");\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"formControl\", ctx.filter);\n        i0.ɵɵadvance(23);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(32, 5, ctx.sortedData));\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate(ctx.getTotalPackagePrice());\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\"\", ctx.getTotalCost(), \"(\\u0441 \\u0442\\u0430\\u043A\\u0441\\u0430 \\u0442\\u0440\\u0430\\u043D\\u0441\\u043F\\u043E\\u0440\\u0442)\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"src\", ctx.payppalIcon, i0.ɵɵsanitizeUrl);\n      }\n    },\n    styles: [\".search[_ngcontent-%COMP%]{margin-top:20px;margin-left:20px;display:flex}.hrStyle[_ngcontent-%COMP%]{border-top:1px solid #8c8b8b;border-bottom:1px solid #fff;margin-bottom:-10px}.flexcon[_ngcontent-%COMP%]{display:flex}.paypal-container[_ngcontent-%COMP%]{display:flex;align-items:center}.paypal-button[_ngcontent-%COMP%]{background-color:#0070ba;color:#fff;padding:10px 20px;border:none;border-radius:5px;font-size:16px}.paypal-logo[_ngcontent-%COMP%]{height:50px}\"]\n  });\n  return LayoutComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}