{"ast":null,"code":"import _asyncToGenerator from \"E:/Programs/SpringAngularProject/angular7-springboot-crud-tutorial-master/update-version/angular7-spring-boot-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from '@angular/core';\nimport { EventEmitter, Injectable, Inject, Directive, Input, NgModule, Optional, SkipSelf } from '@angular/core';\nimport { BehaviorSubject, skip, filter, take, ReplaySubject, AsyncSubject, isObservable } from 'rxjs';\nimport { CommonModule } from '@angular/common';\nclass BaseLoginProvider {\n  constructor() {}\n  loadScript(id, src, onload, parentElement = null) {\n    // get document if platform is only browser\n    if (typeof document !== 'undefined' && !document.getElementById(id)) {\n      let signInJS = document.createElement('script');\n      signInJS.async = true;\n      signInJS.src = src;\n      signInJS.onload = onload;\n      if (!parentElement) {\n        parentElement = document.head;\n      }\n      parentElement.appendChild(signInJS);\n    }\n  }\n}\nclass SocialUser {}\nconst defaultInitOptions = {\n  oneTapEnabled: true\n};\nlet GoogleLoginProvider = /*#__PURE__*/(() => {\n  class GoogleLoginProvider extends BaseLoginProvider {\n    constructor(clientId, initOptions) {\n      super();\n      this.clientId = clientId;\n      this.initOptions = initOptions;\n      this.changeUser = new EventEmitter();\n      this._socialUser = new BehaviorSubject(null);\n      this._accessToken = new BehaviorSubject(null);\n      this._receivedAccessToken = new EventEmitter();\n      this.initOptions = {\n        ...defaultInitOptions,\n        ...this.initOptions\n      };\n      // emit changeUser events but skip initial value from behaviorSubject\n      this._socialUser.pipe(skip(1)).subscribe(this.changeUser);\n      // emit receivedAccessToken but skip initial value from behaviorSubject\n      this._accessToken.pipe(skip(1)).subscribe(this._receivedAccessToken);\n    }\n    initialize(autoLogin) {\n      return new Promise((resolve, reject) => {\n        try {\n          this.loadScript(GoogleLoginProvider.PROVIDER_ID, 'https://accounts.google.com/gsi/client', () => {\n            google.accounts.id.initialize({\n              client_id: this.clientId,\n              auto_select: autoLogin,\n              callback: ({\n                credential\n              }) => {\n                const socialUser = this.createSocialUser(credential);\n                this._socialUser.next(socialUser);\n              },\n              prompt_parent_id: this.initOptions?.prompt_parent_id,\n              itp_support: this.initOptions.oneTapEnabled\n            });\n            if (this.initOptions.oneTapEnabled) {\n              this._socialUser.pipe(filter(user => user === null)).subscribe(() => google.accounts.id.prompt(console.debug));\n            }\n            if (this.initOptions.scopes) {\n              const scope = this.initOptions.scopes instanceof Array ? this.initOptions.scopes.filter(s => s).join(' ') : this.initOptions.scopes;\n              this._tokenClient = google.accounts.oauth2.initTokenClient({\n                client_id: this.clientId,\n                scope,\n                prompt: this.initOptions.prompt,\n                callback: tokenResponse => {\n                  if (tokenResponse.error) {\n                    this._accessToken.error({\n                      code: tokenResponse.error,\n                      description: tokenResponse.error_description,\n                      uri: tokenResponse.error_uri\n                    });\n                  } else {\n                    this._accessToken.next(tokenResponse.access_token);\n                  }\n                }\n              });\n            }\n            resolve();\n          });\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n    getLoginStatus() {\n      return new Promise((resolve, reject) => {\n        if (this._socialUser.value) {\n          resolve(this._socialUser.value);\n        } else {\n          reject(`No user is currently logged in with ${GoogleLoginProvider.PROVIDER_ID}`);\n        }\n      });\n    }\n    refreshToken() {\n      return new Promise((resolve, reject) => {\n        google.accounts.id.revoke(this._socialUser.value.id, response => {\n          if (response.error) reject(response.error);else resolve(this._socialUser.value);\n        });\n      });\n    }\n    getAccessToken() {\n      return new Promise((resolve, reject) => {\n        if (!this._tokenClient) {\n          if (this._socialUser.value) {\n            reject('No token client was instantiated, you should specify some scopes.');\n          } else {\n            reject('You should be logged-in first.');\n          }\n        } else {\n          this._tokenClient.requestAccessToken({\n            hint: this._socialUser.value?.email\n          });\n          this._receivedAccessToken.pipe(take(1)).subscribe(resolve);\n        }\n      });\n    }\n    revokeAccessToken() {\n      return new Promise((resolve, reject) => {\n        if (!this._tokenClient) {\n          reject('No token client was instantiated, you should specify some scopes.');\n        } else if (!this._accessToken.value) {\n          reject('No access token to revoke');\n        } else {\n          google.accounts.oauth2.revoke(this._accessToken.value, () => {\n            this._accessToken.next(null);\n            resolve();\n          });\n        }\n      });\n    }\n    signIn() {\n      return Promise.reject('You should not call this method directly for Google, use \"<asl-google-signin-button>\" wrapper ' + 'or generate the button yourself with \"google.accounts.id.renderButton()\" ' + '(https://developers.google.com/identity/gsi/web/guides/display-button#javascript)');\n    }\n    signOut() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        google.accounts.id.disableAutoSelect();\n        _this._socialUser.next(null);\n      })();\n    }\n    createSocialUser(idToken) {\n      const user = new SocialUser();\n      user.idToken = idToken;\n      const payload = this.decodeJwt(idToken);\n      user.id = payload.sub;\n      user.name = payload.name;\n      user.email = payload.email;\n      user.photoUrl = payload.picture;\n      user.firstName = payload['given_name'];\n      user.lastName = payload['family_name'];\n      return user;\n    }\n    decodeJwt(idToken) {\n      const base64Url = idToken.split(\".\")[1];\n      const base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n      const jsonPayload = decodeURIComponent(window.atob(base64).split(\"\").map(function (c) {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(\"\"));\n      return JSON.parse(jsonPayload);\n    }\n  }\n  GoogleLoginProvider.PROVIDER_ID = 'GOOGLE';\n\n  /**\r\n   * The service encapsulating the social login functionality. Exposes methods like\r\n   * `signIn`, `signOut`. Also, exposes an `authState` `Observable` that one can\r\n   * subscribe to get the current logged in user information.\r\n   *\r\n   * @dynamic\r\n   */\n  return GoogleLoginProvider;\n})();\nlet SocialAuthService = /*#__PURE__*/(() => {\n  class SocialAuthService {\n    /** An `Observable` that one can subscribe to get the current logged in user information */\n    get authState() {\n      return this._authState.asObservable();\n    }\n    /** An `Observable` to communicate the readiness of the service and associated login providers */\n    get initState() {\n      return this._initState.asObservable();\n    }\n    /**\r\n     * @param config A `SocialAuthServiceConfig` object or a `Promise` that resolves to a `SocialAuthServiceConfig` object\r\n     */\n    constructor(config, _ngZone, _injector) {\n      this._ngZone = _ngZone;\n      this._injector = _injector;\n      this.providers = new Map();\n      this.autoLogin = false;\n      this._user = null;\n      this._authState = new ReplaySubject(1);\n      /* Consider making this an enum comprising LOADING, LOADED, FAILED etc. */\n      this.initialized = false;\n      this._initState = new AsyncSubject();\n      if (config instanceof Promise) {\n        config.then(config => {\n          this.initialize(config);\n        });\n      } else {\n        this.initialize(config);\n      }\n    }\n    initialize(config) {\n      this.autoLogin = config.autoLogin !== undefined ? config.autoLogin : false;\n      const {\n        onError = console.error\n      } = config;\n      config.providers.forEach(item => {\n        this.providers.set(item.id, 'prototype' in item.provider ? this._injector.get(item.provider) : item.provider);\n      });\n      Promise.all(Array.from(this.providers.values()).map(provider => provider.initialize(this.autoLogin))).then(() => {\n        if (this.autoLogin) {\n          const loginStatusPromises = [];\n          let loggedIn = false;\n          this.providers.forEach((provider, key) => {\n            const promise = provider.getLoginStatus();\n            loginStatusPromises.push(promise);\n            promise.then(user => {\n              this.setUser(user, key);\n              loggedIn = true;\n            }).catch(console.debug);\n          });\n          Promise.all(loginStatusPromises).catch(() => {\n            if (!loggedIn) {\n              this._user = null;\n              this._authState.next(null);\n            }\n          });\n        }\n        this.providers.forEach((provider, key) => {\n          if (isObservable(provider.changeUser)) {\n            provider.changeUser.subscribe(user => {\n              this._ngZone.run(() => {\n                this.setUser(user, key);\n              });\n            });\n          }\n        });\n      }).catch(error => {\n        onError(error);\n      }).finally(() => {\n        this.initialized = true;\n        this._initState.next(this.initialized);\n        this._initState.complete();\n      });\n    }\n    getAccessToken(providerId) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const providerObject = _this2.providers.get(providerId);\n        if (!_this2.initialized) {\n          throw SocialAuthService.ERR_NOT_INITIALIZED;\n        } else if (!providerObject) {\n          throw SocialAuthService.ERR_LOGIN_PROVIDER_NOT_FOUND;\n        } else if (!(providerObject instanceof GoogleLoginProvider)) {\n          throw SocialAuthService.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN;\n        }\n        return yield providerObject.getAccessToken();\n      })();\n    }\n    refreshAuthToken(providerId) {\n      return new Promise((resolve, reject) => {\n        if (!this.initialized) {\n          reject(SocialAuthService.ERR_NOT_INITIALIZED);\n        } else {\n          const providerObject = this.providers.get(providerId);\n          if (providerObject) {\n            if (typeof providerObject.refreshToken !== 'function') {\n              reject(SocialAuthService.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);\n            } else {\n              providerObject.refreshToken().then(user => {\n                this.setUser(user, providerId);\n                resolve();\n              }).catch(err => {\n                reject(err);\n              });\n            }\n          } else {\n            reject(SocialAuthService.ERR_LOGIN_PROVIDER_NOT_FOUND);\n          }\n        }\n      });\n    }\n    refreshAccessToken(providerId) {\n      return new Promise((resolve, reject) => {\n        if (!this.initialized) {\n          reject(SocialAuthService.ERR_NOT_INITIALIZED);\n        } else if (providerId !== GoogleLoginProvider.PROVIDER_ID) {\n          reject(SocialAuthService.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);\n        } else {\n          const providerObject = this.providers.get(providerId);\n          if (providerObject instanceof GoogleLoginProvider) {\n            providerObject.revokeAccessToken().then(resolve).catch(reject);\n          } else {\n            reject(SocialAuthService.ERR_LOGIN_PROVIDER_NOT_FOUND);\n          }\n        }\n      });\n    }\n    /**\r\n     * A method used to sign in a user with a specific `LoginProvider`.\r\n     *\r\n     * @param providerId Id with which the `LoginProvider` has been registered with the service\r\n     * @param signInOptions Optional `LoginProvider` specific arguments\r\n     * @returns A `Promise` that resolves to the authenticated user information\r\n     */\n    signIn(providerId, signInOptions) {\n      return new Promise((resolve, reject) => {\n        if (!this.initialized) {\n          reject(SocialAuthService.ERR_NOT_INITIALIZED);\n        } else {\n          let providerObject = this.providers.get(providerId);\n          if (providerObject) {\n            providerObject.signIn(signInOptions).then(user => {\n              this.setUser(user, providerId);\n              resolve(user);\n            }).catch(err => {\n              reject(err);\n            });\n          } else {\n            reject(SocialAuthService.ERR_LOGIN_PROVIDER_NOT_FOUND);\n          }\n        }\n      });\n    }\n    /**\r\n     * A method used to sign out the currently loggen in user.\r\n     *\r\n     * @param revoke Optional parameter to specify whether a hard sign out is to be performed\r\n     * @returns A `Promise` that resolves if the operation is successful, rejects otherwise\r\n     */\n    signOut(revoke = false) {\n      return new Promise((resolve, reject) => {\n        if (!this.initialized) {\n          reject(SocialAuthService.ERR_NOT_INITIALIZED);\n        } else if (!this._user) {\n          reject(SocialAuthService.ERR_NOT_LOGGED_IN);\n        } else {\n          let providerId = this._user.provider;\n          let providerObject = this.providers.get(providerId);\n          if (providerObject) {\n            providerObject.signOut(revoke).then(() => {\n              resolve();\n              this.setUser(null);\n            }).catch(err => {\n              reject(err);\n            });\n          } else {\n            reject(SocialAuthService.ERR_LOGIN_PROVIDER_NOT_FOUND);\n          }\n        }\n      });\n    }\n    setUser(user, id) {\n      if (user && id) user.provider = id;\n      this._user = user;\n      this._authState.next(user);\n    }\n  }\n  SocialAuthService.ERR_LOGIN_PROVIDER_NOT_FOUND = 'Login provider not found';\n  SocialAuthService.ERR_NOT_LOGGED_IN = 'Not logged in';\n  SocialAuthService.ERR_NOT_INITIALIZED = 'Login providers not ready yet. Are there errors on your console?';\n  SocialAuthService.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN = 'Chosen login provider is not supported for refreshing a token';\n  SocialAuthService.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN = 'Chosen login provider is not supported for getting an access token';\n  SocialAuthService.ɵfac = function SocialAuthService_Factory(t) {\n    return new (t || SocialAuthService)(i0.ɵɵinject('SocialAuthServiceConfig'), i0.ɵɵinject(i0.NgZone), i0.ɵɵinject(i0.Injector));\n  };\n  SocialAuthService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: SocialAuthService,\n    factory: SocialAuthService.ɵfac,\n    providedIn: 'root'\n  });\n  return SocialAuthService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet GoogleSigninButtonDirective = /*#__PURE__*/(() => {\n  class GoogleSigninButtonDirective {\n    constructor(el, socialAuthService) {\n      this.type = 'icon';\n      this.size = 'medium';\n      this.text = 'signin_with';\n      this.shape = 'rectangular';\n      this.theme = 'outline';\n      this.logo_alignment = 'left';\n      this.width = '';\n      this.locale = '';\n      socialAuthService.initState.pipe(take(1)).subscribe(() => {\n        Promise.resolve(this.width).then(value => {\n          if (value > '400' || value < '200' && value != '') {\n            Promise.reject('Please note .. max-width 400 , min-width 200 ' + '(https://developers.google.com/identity/gsi/web/tools/configurator)');\n          } else {\n            google.accounts.id.renderButton(el.nativeElement, {\n              type: this.type,\n              size: this.size,\n              text: this.text,\n              width: this.width,\n              shape: this.shape,\n              theme: this.theme,\n              logo_alignment: this.logo_alignment,\n              locale: this.locale\n            });\n          }\n        });\n      });\n    }\n  }\n  GoogleSigninButtonDirective.ɵfac = function GoogleSigninButtonDirective_Factory(t) {\n    return new (t || GoogleSigninButtonDirective)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(SocialAuthService));\n  };\n  GoogleSigninButtonDirective.ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n    type: GoogleSigninButtonDirective,\n    selectors: [[\"asl-google-signin-button\"]],\n    inputs: {\n      type: \"type\",\n      size: \"size\",\n      text: \"text\",\n      shape: \"shape\",\n      theme: \"theme\",\n      logo_alignment: \"logo_alignment\",\n      width: \"width\",\n      locale: \"locale\"\n    }\n  });\n  return GoogleSigninButtonDirective;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\r\n * The main module of angularx-social-login library.\r\n */\nlet SocialLoginModule = /*#__PURE__*/(() => {\n  class SocialLoginModule {\n    static initialize(config) {\n      return {\n        ngModule: SocialLoginModule,\n        providers: [SocialAuthService, {\n          provide: 'SocialAuthServiceConfig',\n          useValue: config\n        }]\n      };\n    }\n    constructor(parentModule) {\n      if (parentModule) {\n        throw new Error('SocialLoginModule is already loaded. Import it in the AppModule only');\n      }\n    }\n  }\n  SocialLoginModule.ɵfac = function SocialLoginModule_Factory(t) {\n    return new (t || SocialLoginModule)(i0.ɵɵinject(SocialLoginModule, 12));\n  };\n  SocialLoginModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n    type: SocialLoginModule\n  });\n  SocialLoginModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n    providers: [SocialAuthService],\n    imports: [CommonModule]\n  });\n  return SocialLoginModule;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n// Simulates login / logout without actually requiring an Internet connection.\n//\n// Useful for certain development situations.\n//\n// For example, if you want to simulate the greatest football referee England has ever produced:\n//\n//  const dummyUser: SocialUser = {\n//     id: '0123456789',\n//     name: 'Howard Webb',\n//     email: 'howard@webb.com',\n//     firstName: 'Howard',\n//     lastName: 'Webb',\n//     authToken: 'dummyAuthToken',\n//     photoUrl: 'https://en.wikipedia.org/wiki/Howard_Webb#/media/File:Howard_Webb_march11.jpg',\n//     provider: 'DUMMY',\n//     idToken: 'dummyIdToken',\n//     authorizationCode: 'dummyAuthCode'\n// };\n//\n//  let config = new AuthServiceConfig([\n//  { ... },\n//  {\n//       id: DummyLoginProvider.PROVIDER_ID,\n//       provider: new DummyLoginProvider(dummyUser)  // Pass your user into the constructor\n//   },\n//  { ... }\n//  ]);\nlet DummyLoginProvider = /*#__PURE__*/(() => {\n  class DummyLoginProvider extends BaseLoginProvider {\n    constructor(dummy) {\n      super();\n      if (dummy) {\n        this.dummy = dummy;\n      } else {\n        this.dummy = DummyLoginProvider.DEFAULT_USER;\n      }\n      // Start not logged in\n      this.loggedIn = false;\n    }\n    getLoginStatus() {\n      return new Promise((resolve, reject) => {\n        if (this.loggedIn) {\n          resolve(this.dummy);\n        } else {\n          reject('No user is currently logged in.');\n        }\n      });\n    }\n    initialize() {\n      return new Promise((resolve, reject) => {\n        resolve();\n      });\n    }\n    signIn() {\n      return new Promise((resolve, reject) => {\n        this.loggedIn = true;\n        resolve(this.dummy);\n      });\n    }\n    signOut(revoke) {\n      return new Promise((resolve, reject) => {\n        this.loggedIn = false;\n        resolve();\n      });\n    }\n  }\n  DummyLoginProvider.PROVIDER_ID = 'DUMMY';\n  DummyLoginProvider.DEFAULT_USER = {\n    id: '1234567890',\n    name: 'Mickey Mouse',\n    email: 'mickey@mouse.com',\n    firstName: 'Mickey',\n    lastName: 'Mouse',\n    authToken: 'dummyAuthToken',\n    photoUrl: 'https://en.wikipedia.org/wiki/File:Mickey_Mouse.png',\n    provider: 'DUMMY',\n    idToken: 'dummyIdToken',\n    authorizationCode: 'dummyAuthCode',\n    response: {}\n  };\n  return DummyLoginProvider;\n})();\nlet FacebookLoginProvider = /*#__PURE__*/(() => {\n  class FacebookLoginProvider extends BaseLoginProvider {\n    constructor(clientId, initOptions = {}) {\n      super();\n      this.clientId = clientId;\n      this.requestOptions = {\n        scope: 'email,public_profile',\n        locale: 'en_US',\n        fields: 'name,email,picture,first_name,last_name',\n        version: 'v10.0'\n      };\n      this.requestOptions = {\n        ...this.requestOptions,\n        ...initOptions\n      };\n    }\n    initialize() {\n      return new Promise((resolve, reject) => {\n        try {\n          this.loadScript(FacebookLoginProvider.PROVIDER_ID, `//connect.facebook.net/${this.requestOptions.locale}/sdk.js`, () => {\n            FB.init({\n              appId: this.clientId,\n              autoLogAppEvents: true,\n              cookie: true,\n              xfbml: true,\n              version: this.requestOptions.version\n            });\n            resolve();\n          });\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n    getLoginStatus() {\n      return new Promise((resolve, reject) => {\n        FB.getLoginStatus(response => {\n          if (response.status === 'connected') {\n            let authResponse = response.authResponse;\n            FB.api(`/me?fields=${this.requestOptions.fields}`, fbUser => {\n              let user = new SocialUser();\n              user.id = fbUser.id;\n              user.name = fbUser.name;\n              user.email = fbUser.email;\n              user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal&access_token=' + authResponse.accessToken;\n              user.firstName = fbUser.first_name;\n              user.lastName = fbUser.last_name;\n              user.authToken = authResponse.accessToken;\n              user.response = fbUser;\n              resolve(user);\n            });\n          } else {\n            reject(`No user is currently logged in with ${FacebookLoginProvider.PROVIDER_ID}`);\n          }\n        });\n      });\n    }\n    signIn(signInOptions) {\n      const options = {\n        ...this.requestOptions,\n        ...signInOptions\n      };\n      return new Promise((resolve, reject) => {\n        FB.login(response => {\n          if (response.authResponse) {\n            let authResponse = response.authResponse;\n            FB.api(`/me?fields=${options.fields}`, fbUser => {\n              let user = new SocialUser();\n              user.id = fbUser.id;\n              user.name = fbUser.name;\n              user.email = fbUser.email;\n              user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal';\n              user.firstName = fbUser.first_name;\n              user.lastName = fbUser.last_name;\n              user.authToken = authResponse.accessToken;\n              user.response = fbUser;\n              resolve(user);\n            });\n          } else {\n            reject('User cancelled login or did not fully authorize.');\n          }\n        }, options);\n      });\n    }\n    signOut() {\n      return new Promise((resolve, reject) => {\n        FB.logout(response => {\n          resolve();\n        });\n      });\n    }\n  }\n  FacebookLoginProvider.PROVIDER_ID = 'FACEBOOK';\n  return FacebookLoginProvider;\n})();\nlet AmazonLoginProvider = /*#__PURE__*/(() => {\n  class AmazonLoginProvider extends BaseLoginProvider {\n    constructor(clientId, initOptions = {\n      scope: 'profile',\n      scope_data: {\n        profile: {\n          essential: false\n        }\n      },\n      redirect_uri: location.origin\n    }) {\n      super();\n      this.clientId = clientId;\n      this.initOptions = initOptions;\n    }\n    initialize() {\n      let amazonRoot = null;\n      if (document) {\n        amazonRoot = document.createElement('div');\n        amazonRoot.id = 'amazon-root';\n        document.body.appendChild(amazonRoot);\n      }\n      window.onAmazonLoginReady = () => {\n        amazon.Login.setClientId(this.clientId);\n      };\n      return new Promise((resolve, reject) => {\n        try {\n          this.loadScript('amazon-login-sdk', 'https://assets.loginwithamazon.com/sdk/na/login1.js', () => {\n            resolve();\n          }, amazonRoot);\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n    getLoginStatus() {\n      return new Promise((resolve, reject) => {\n        let token = this.retrieveToken();\n        if (token) {\n          amazon.Login.retrieveProfile(token, response => {\n            if (response.success) {\n              let user = new SocialUser();\n              user.id = response.profile.CustomerId;\n              user.name = response.profile.Name;\n              user.email = response.profile.PrimaryEmail;\n              user.response = response.profile;\n              resolve(user);\n            } else {\n              reject(response.error);\n            }\n          });\n        } else {\n          reject(`No user is currently logged in with ${AmazonLoginProvider.PROVIDER_ID}`);\n        }\n      });\n    }\n    signIn(signInOptions) {\n      const options = {\n        ...this.initOptions,\n        ...signInOptions\n      };\n      return new Promise((resolve, reject) => {\n        amazon.Login.authorize(options, authResponse => {\n          if (authResponse.error) {\n            reject(authResponse.error);\n          } else {\n            amazon.Login.retrieveProfile(authResponse.access_token, response => {\n              let user = new SocialUser();\n              user.id = response.profile.CustomerId;\n              user.name = response.profile.Name;\n              user.email = response.profile.PrimaryEmail;\n              user.authToken = authResponse.access_token;\n              user.response = response.profile;\n              this.persistToken(authResponse.access_token);\n              resolve(user);\n            });\n          }\n        });\n      });\n    }\n    signOut() {\n      return new Promise((resolve, reject) => {\n        try {\n          amazon.Login.logout();\n          this.clearToken();\n          resolve();\n        } catch (err) {\n          reject(err.message);\n        }\n      });\n    }\n    persistToken(token) {\n      localStorage.setItem(`${AmazonLoginProvider.PROVIDER_ID}_token`, token);\n    }\n    retrieveToken() {\n      return localStorage.getItem(`${AmazonLoginProvider.PROVIDER_ID}_token`);\n    }\n    clearToken() {\n      localStorage.removeItem(`${AmazonLoginProvider.PROVIDER_ID}_token`);\n    }\n  }\n  AmazonLoginProvider.PROVIDER_ID = 'AMAZON';\n  return AmazonLoginProvider;\n})();\nlet VKLoginProvider = /*#__PURE__*/(() => {\n  class VKLoginProvider extends BaseLoginProvider {\n    constructor(clientId, initOptions = {\n      fields: 'photo_max,contacts',\n      version: '5.124'\n    }) {\n      super();\n      this.clientId = clientId;\n      this.initOptions = initOptions;\n      this.VK_API_URL = '//vk.com/js/api/openapi.js';\n      this.VK_API_GET_USER = 'users.get';\n    }\n    initialize() {\n      return new Promise((resolve, reject) => {\n        try {\n          this.loadScript(VKLoginProvider.PROVIDER_ID, this.VK_API_URL, () => {\n            VK.init({\n              apiId: this.clientId\n            });\n            resolve();\n          });\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n    getLoginStatus() {\n      return new Promise((resolve, reject) => this.getLoginStatusInternal(resolve, reject));\n    }\n    signIn() {\n      return new Promise((resolve, reject) => this.signInInternal(resolve, reject));\n    }\n    signOut() {\n      return new Promise((resolve, reject) => {\n        VK.Auth.logout(response => {\n          resolve();\n        });\n      });\n    }\n    signInInternal(resolve, reject) {\n      VK.Auth.login(loginResponse => {\n        if (loginResponse.status === 'connected') {\n          this.getUser(loginResponse.session.mid, loginResponse.session.sid, resolve);\n        }\n      });\n    }\n    getUser(userId, token, resolve) {\n      VK.Api.call(this.VK_API_GET_USER, {\n        user_id: userId,\n        fields: this.initOptions.fields,\n        v: this.initOptions.version\n      }, userResponse => {\n        resolve(this.createUser(Object.assign({}, {\n          token\n        }, userResponse.response[0])));\n      });\n    }\n    getLoginStatusInternal(resolve, reject) {\n      VK.Auth.getLoginStatus(loginResponse => {\n        if (loginResponse.status === 'connected') {\n          this.getUser(loginResponse.session.mid, loginResponse.session.sid, resolve);\n        }\n      });\n    }\n    createUser(response) {\n      const user = new SocialUser();\n      user.id = response.id;\n      user.name = `${response.first_name} ${response.last_name}`;\n      user.photoUrl = response.photo_max;\n      user.authToken = response.token;\n      return user;\n    }\n  }\n  VKLoginProvider.PROVIDER_ID = 'VK';\n\n  /**\r\n   * Protocol modes supported by MSAL.\r\n   */\n  return VKLoginProvider;\n})();\nvar ProtocolMode = /*#__PURE__*/(() => {\n  (function (ProtocolMode) {\n    ProtocolMode[\"AAD\"] = \"AAD\";\n    ProtocolMode[\"OIDC\"] = \"OIDC\";\n  })(ProtocolMode || (ProtocolMode = {}));\n  return ProtocolMode;\n})();\nconst COMMON_AUTHORITY = 'https://login.microsoftonline.com/common/';\n/**\r\n * Microsoft Authentication using MSAL v2: https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/lib/msal-browser\r\n */\nlet MicrosoftLoginProvider = /*#__PURE__*/(() => {\n  class MicrosoftLoginProvider extends BaseLoginProvider {\n    constructor(clientId, initOptions) {\n      super();\n      this.clientId = clientId;\n      this.initOptions = {\n        authority: COMMON_AUTHORITY,\n        scopes: ['openid', 'email', 'profile', 'User.Read'],\n        knownAuthorities: [],\n        protocolMode: ProtocolMode.AAD,\n        clientCapabilities: [],\n        cacheLocation: 'sessionStorage'\n      };\n      this.initOptions = {\n        ...this.initOptions,\n        ...initOptions\n      };\n    }\n    initialize() {\n      return new Promise((resolve, reject) => {\n        this.loadScript(MicrosoftLoginProvider.PROVIDER_ID, 'https://alcdn.msauth.net/browser/2.13.1/js/msal-browser.min.js', () => {\n          try {\n            const config = {\n              auth: {\n                clientId: this.clientId,\n                redirectUri: this.initOptions.redirect_uri ?? location.origin,\n                authority: this.initOptions.authority,\n                knownAuthorities: this.initOptions.knownAuthorities,\n                protocolMode: this.initOptions.protocolMode,\n                clientCapabilities: this.initOptions.clientCapabilities\n              },\n              cache: !this.initOptions.cacheLocation ? null : {\n                cacheLocation: this.initOptions.cacheLocation\n              }\n            };\n            this._instance = new msal.PublicClientApplication(config);\n            resolve();\n          } catch (e) {\n            reject(e);\n          }\n        });\n      });\n    }\n    getSocialUser(loginResponse) {\n      return new Promise((resolve, reject) => {\n        //After login, use Microsoft Graph API to get user info\n        let meRequest = new XMLHttpRequest();\n        meRequest.onreadystatechange = () => {\n          if (meRequest.readyState == 4) {\n            try {\n              if (meRequest.status == 200) {\n                let userInfo = JSON.parse(meRequest.responseText);\n                let user = new SocialUser();\n                user.provider = MicrosoftLoginProvider.PROVIDER_ID;\n                user.id = loginResponse.idToken;\n                user.authToken = loginResponse.accessToken;\n                user.name = loginResponse.idTokenClaims.name;\n                user.email = loginResponse.account.username;\n                user.idToken = loginResponse.idToken;\n                user.response = loginResponse;\n                user.firstName = userInfo.givenName;\n                user.lastName = userInfo.surname;\n                resolve(user);\n              } else {\n                reject(`Error retrieving user info: ${meRequest.status}`);\n              }\n            } catch (err) {\n              reject(err);\n            }\n          }\n        };\n        //Microsoft Graph ME Endpoint: https://docs.microsoft.com/en-us/graph/api/user-get?view=graph-rest-1.0&tabs=http\n        meRequest.open('GET', 'https://graph.microsoft.com/v1.0/me');\n        meRequest.setRequestHeader('Authorization', `Bearer ${loginResponse.accessToken}`);\n        try {\n          meRequest.send();\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n    getLoginStatus() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const accounts = _this3._instance.getAllAccounts();\n        if (accounts?.length > 0) {\n          const loginResponse = yield _this3._instance.ssoSilent({\n            scopes: _this3.initOptions.scopes,\n            loginHint: accounts[0].username\n          });\n          return yield _this3.getSocialUser(loginResponse);\n        } else {\n          throw `No user is currently logged in with ${MicrosoftLoginProvider.PROVIDER_ID}`;\n        }\n      })();\n    }\n    signIn() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        const loginResponse = yield _this4._instance.loginPopup({\n          scopes: _this4.initOptions.scopes,\n          prompt: _this4.initOptions.prompt\n        });\n        return yield _this4.getSocialUser(loginResponse);\n      })();\n    }\n    signOut(revoke) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        const accounts = _this5._instance.getAllAccounts();\n        if (accounts?.length > 0) {\n          yield _this5._instance.logoutPopup({\n            account: accounts[0],\n            postLogoutRedirectUri: _this5.initOptions.logout_redirect_uri ?? _this5.initOptions.redirect_uri ?? location.href\n          });\n        }\n      })();\n    }\n  }\n  MicrosoftLoginProvider.PROVIDER_ID = 'MICROSOFT';\n\n  /**\r\n   * Generated bundle index. Do not edit.\r\n   */\n  return MicrosoftLoginProvider;\n})();\nexport { AmazonLoginProvider, BaseLoginProvider, DummyLoginProvider, FacebookLoginProvider, GoogleLoginProvider, GoogleSigninButtonDirective, MicrosoftLoginProvider, SocialAuthService, SocialLoginModule, SocialUser, VKLoginProvider };\n//# sourceMappingURL=abacritt-angularx-social-login.mjs.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}